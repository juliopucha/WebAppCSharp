--11:50 29/1/2023 
--Las l-ineas en blanco son detectadas por SQLplus como
--el inicio de un nuevo comando. Por lo tanto, -estas
--se deben borrar.
--------------------
--(Act.)23:11 21/6/2023
--Luego de crear la base  de datos, se  debe crear
--de manera autom-atica el respaldo (backup) y
--el escript para luego volver a recuperar sin
--inconvenientes en caso de requerirlo.
---------------------
USE COURIER;


-- error de escritura en el ID del OBJETO
-- IF OBJECT_ID ('COURIER') IS NOT NULL
IF OBJECT_ID ('CONDUCTOR') IS NOT NULL 
DROP TABLE CONDUCTOR;
CREATE TABLE CONDUCTOR(
 CEDULA VARCHAR(10) NOT NULL PRIMARY KEY, 
 NOMBRE VARCHAR(50) NULL,
 TELEFONO VARCHAR(15),
 DIRECCION VARCHAR(20),
 SALARIO DECIMAL(8,2),
 CIUDAD VARCHAR(15)
);

IF OBJECT_ID('CAMION') IS NOT NULL
DROP TABLE CAMION;
CREATE TABLE CAMION(
 PLACA VARCHAR(10) NOT NULL PRIMARY KEY,
 MODELO VARCHAR(15) NULL,
 TIPO VARCHAR(15),
 POTENCIA VARCHAR(10)
);

IF OBJECT_ID('CONDUCE') IS NOT NULL
DROP TABLE CONDUCE;
CREATE TABLE CONDUCE(
 CEDULA_CONDUCTOR VARCHAR(10),
 PLACA_CAMION VARCHAR(10),
 FECHA DATETIME,
 --FECHA DATE,
 PRIMARY KEY(CEDULA_CONDUCTOR, PLACA_CAMION, FECHA)
);
--Para que no existan registros repetidos, se forma una Clave Primaria Compuesta.

IF OBJECT_ID('PROVINCIA') IS NOT NULL
DROP TABLE PROVINCIA;
CREATE TABLE PROVINCIA(
 COD_PROVINCIA VARCHAR(10) PRIMARY KEY,
 NOMBRE VARCHAR(15)
);

IF OBJECT_ID('PAQUETE') IS NOT NULL
DROP TABLE PAQUETE;
CREATE TABLE PAQUETE(
 COD_PAQUETE VARCHAR(10) PRIMARY KEY,
 DESCRIPCION VARCHAR(30),--Aumentar de tama-no
 DESTINATARIO VARCHAR(50),
 DIRECCION_DESTINATARIO VARCHAR(20),----Aumentar de tama-no
 CEDULA_CONDUCTOR VARCHAR(10),
 PROVINCIA_DESTINO VARCHAR(10), 
 --En el campo "PROVINCIA_DESTINO" se ingresa el "C-odigo de provincia"
);

-------------------------------------
----------------Restricciones:

--En la tabla "CONDUCE":

 ALTER TABLE CONDUCE
	ADD CONSTRAINT FK_CONDUCE_CEDULACONDUCTOR
	FOREIGN KEY (CEDULA_CONDUCTOR)
	REFERENCES CONDUCTOR(CEDULA)
	ON UPDATE CASCADE
	ON DELETE CASCADE;
	
ALTER TABLE CONDUCE
	ADD CONSTRAINT FK_CONDUCE_PLACACAMION
	FOREIGN KEY (PLACA_CAMION) 
	REFERENCES CAMION(PLACA)
	ON UPDATE CASCADE
	ON DELETE CASCADE;

--En la tabla "PAQUETE":

ALTER TABLE PAQUETE
	ADD CONSTRAINT FK_PAQUETE_CEDULACONDUCTOR
	FOREIGN KEY(CEDULA_CONDUCTOR)
	REFERENCES CONDUCTOR (CEDULA)
	ON UPDATE CASCADE
	ON DELETE CASCADE;

ALTER TABLE PAQUETE
	ADD CONSTRAINT FK_PAQUETE_PROVINCIADESTINO
	FOREIGN KEY (PROVINCIA_DESTINO) 
	REFERENCES PROVINCIA(COD_PROVINCIA)
	ON UPDATE CASCADE
	ON DELETE CASCADE;	

---------------------------------------
--Consultar las restricciones:
--SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_NAME = 'CONDUCE';
--SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE TABLE_NAME = 'PAQUETE';


--INSERCI-ON O INGRESO DE DATOS---
INSERT INTO CONDUCTOR
 VALUES('123456789', 'JUAN PEREZ', '4598498',
 'CALLE N-20', 900000, 'QUITO'),
 ('123456788', 'JAIME PERLA', '3598498',
 'CALLE SO-30', 910000, 'QUITO'),
 ('123456787', 'JEAN PERALTA', '2598498',
 'CALLE SE-20', 920000, 'QUITO');

INSERT INTO CAMION
 VALUES('FK-1010', 'HINO FC 1021', '2DB', '70,13'),
 ('PCR-0123', 'HINO FD 1021', 'S3', '102,00'),
 ('GED-1234', 'HINO GD 1226', '4-C', '133,88');
--Potencia en Cavallos de Vapor.

-----------------------------------------
--Todos los valores de tipo "datetime" se muestran 
--en formato "a-no/mes/d-ia hora:minuto:segundo .milisegundos", 
--independientemente del formato de ingreso que hayamos seteado.

SET DATEFORMAT DMY;
INSERT INTO CONDUCE
 VALUES('123456789', 'FK-1010', '16/06/2023'),
 ('123456788', 'FK-1010', '18/06/2023'),
 ('123456787', 'GED-1234', '20/06/2023');

INSERT INTO PROVINCIA
 VALUES('8080','PICHINCHA'),
 ('7070', 'AZUAY'),
 ('6060', 'GUAYAS'),
 ('5050', 'IMBABURA'),
 ('4040', 'LOJA');
 
INSERT INTO PAQUETE
 VALUES('53434', 'CARTON CON MEDICINA NATURAL', 'JAVIER SANDOVAL', 
 'CALLE S/N 9', '123456789', '8080'),
 ('53435', 'PCB FUENTE 3-OUT', 'FERNANDO BOILESTAD', 
 'AV. 9 DE OCTUBRE', '123456788', '8080'),
 ('53436', '1PAR DE ZAPATILLA ADULTO-H', 'PEDRO HINOSTROZA', --CALZADO
 'ORIENTE ENTRE43 Y 46', '123456787', '6060'),--CALLE ORIENTE ENTRE 43 Y 46
 ('53437', '2 CHAQUETA-M', 'JESSENIA ZAMBRANO CORDERO', 
 'AV. 25 DE JULIO', '123456789', '6060');

--Mostrar tablas
--1)
SELECT * FROM CONDUCTOR;
--2)
SELECT * FROM CAMION;
--3)
SELECT * FROM CONDUCE;
--4)
SELECT * FROM PROVINCIA;
--5)
SELECT * FROM PAQUETE;

-----AL FINAL DE LA PR-ACTICA, SE RECOMIENDA BORRAR TODO---
--DROP TABLE CONDUCTOR CASCADE CONSTRAINTS;

ALTER TABLE CONDUCE DROP CONSTRAINT FK_CONDUCE_CEDULACONDUCTOR;
ALTER TABLE CONDUCE DROP CONSTRAINT FK_CONDUCE_PLACACAMION;
DROP TABLE CONDUCE;
DROP TABLE CAMION;

ALTER TABLE PAQUETE DROP CONSTRAINT FK_PAQUETE_CEDULACONDUCTOR;
ALTER TABLE PAQUETE DROP CONSTRAINT FK_PAQUETE_PROVINCIADESTINO;
DROP TABLE CONDUCTOR;
DROP TABLE PAQUETE;
DROP TABLE PROVINCIA;

